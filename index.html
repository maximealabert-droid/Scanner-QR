<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>index_master_base_v4_auto_scan_square.html</title>
  <style>
    :root{
      /* Premium Light theme */
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;
      --primary:#2563eb;
      --primary-ink:#ffffff;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);
      --shadow-sm: 0 2px 10px rgba(15, 23, 42, .06);
    }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--text); }
    header{
      position: sticky; top:0; z-index:10;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 14px 16px;
      display:flex; flex-direction:column; gap:10px;
    }
    .row { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    label { color: var(--muted); font-size:14px; }
    select, input, textarea{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #ffffff;
      color: var(--text);
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    select:focus, input:focus, textarea:focus{
      outline: none;
      border-color: rgba(37, 99, 235, .55);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, .14);
    }
    input[type="date"], input[type="datetime-local"]{ color-scheme: dark; }
    nav.tabs { display:flex; gap:8px; flex-wrap:wrap; }
    button.tab{ transition: none;
      font-size: 16px;
      padding: 12px 18px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #ffffff;
      color: var(--text);
      cursor:pointer;
      box-shadow: 0 1px 0 rgba(15,23,42,.02);
      transition: transform .05s ease, box-shadow .15s ease, border-color .15s ease;
    }
    button.tab:hover{ box-shadow: var(--shadow-sm); }
    button.tab:active{ transform: translateY(1px); }
    button.tab[aria-selected="true"]{
      background: rgba(37,99,235,.08);
      border-color: rgba(37,99,235,.35);
      box-shadow: 0 6px 18px rgba(37,99,235,.12);
    }
    main { padding:16px; max-width:980px; margin:0 auto; }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .muted{ color: var(--muted); }
    .fields{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin: 12px 0; }
    @media (max-width: 800px){ .fields{ grid-template-columns: 1fr; } }

    /* FORCE offers to always stack vertically */
    .offers{
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 12px;
    }

    .offer{
      padding: 14px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: #ffffff;
      box-shadow: var(--shadow-sm);
      cursor: default;
      user-select: none;
    }

    .pill{
      display:inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f1f5f9;
      color: #334155;
      font-size: 12px;
      margin-right: 6px;
      margin-bottom: 6px;
    }
    .offer .top{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; margin-bottom:8px }
    .ring{ width: 42px; height: 42px; }
    .ring circle{
      fill:none;
      stroke-width:6;
      stroke-linecap:round;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }
    .ring .bg{ stroke: #e5e7eb; }
    .ring .fg{ stroke: #9fb0d0; transition: stroke-dashoffset .6s linear; }
    .countdown{ color: var(--muted); font-size: 18px; margin-top: 6px; }

    .offer .date{ color:var(--muted); font-size: 18px; white-space:nowrap }
    .offer .meta{ color:var(--muted); font-size: 18px; margin-top: 8px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap }

    .toggleBox{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #ffffff;
      box-shadow: 0 1px 0 rgba(15,23,42,.02);
    }
    .toggleBox input{ width: 16px; height:16px; padding:0; margin:0; }
    .toggleBox span{ font-size: 18px; color: var(--text); }

    .actions{ display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap; margin-top: 8px; }
    button.primary{
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(37,99,235,.35);
      background: var(--primary);
      color: var(--primary-ink);
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(37,99,235,.20);
      transition: transform .05s ease, box-shadow .15s ease, filter .15s ease;
    }
    button.primary:hover{ filter: brightness(1.02); box-shadow: 0 14px 28px rgba(37,99,235,.24); }
    button.primary:active{ transform: translateY(1px); }

    .toast{
      position: fixed; bottom: 14px; left: 14px;
      background: rgba(255,255,255,.92);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px 12px;
      color: var(--text);
      display:none;
      z-index: 60;
      box-shadow: var(--shadow-sm);
    }
    .toast.show{ display:block; }
    select{ font-size: 20px; padding: 14px 18px; }
  
    /* FORCE very light corner radius for all pill-like objects */
    .pill,
    .statusBox .pill,
    .offer .pill{
      border-radius: 3px !important;
    }

  
    /* Buyer offer description toggle */
    .descBtn{
      margin-top: 6px;
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.08);
      color: var(--text);
      cursor: pointer;
    }
    .offerDesc{
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed rgba(255,255,255,.15);
      font-size: 18px;
      color: var(--muted);
      display: none;
    }
    .offerDesc.open{
      display: block;
    }

  
    /* Publish layout: fields stacked, labels above inputs */
    #content .fields{
      display: grid;
      grid-template-columns: 1fr !important;
      gap: 12px;
    }
    #content .fields > div{
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    #content .fields label{
      margin-bottom: 6px;
      text-align: left;
    }

  
    /* Publish: Minimum / Maximum d‚Äôachat always visible */
    .valueBlock{
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .valueRow{
      display: flex;
      gap: 12px;
    }
    .field{
      display: flex;
      flex-direction: column;
      flex: 1;
    }

  
  .offerTitle{
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 6px;
    line-height: 1.1;
  }


  /* Publish - Valeur select 10% less wide */
  #valueContainer select,
  #valueContainer input,
  #minBuy,
  #limit{
    width: 90%;
  }


  /* Publish - Description styling */
  #description{
    width: 90%;
    border: 1px solid var(--border);
    border-radius: 12px;
  }


  /* Publish - Description textarea corrected */
  #description{
    width: 90% !important;
    margin: 0 auto;
    border: 1px solid var(--border);
    border-radius: 12px;
    display:block;
  }


  /* Scan camera square format */
  #reader, #scanner-container, video {
    aspect-ratio: 1 / 1;
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
    object-fit: cover;
  }

</style>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
  // --- Seller modal (buyer offer -> click seller name) ---
  function sellerDisplayName(sellerId){
    const u = getUser(sellerId);
    const p = state?.[sellerId]?.profile || u?.profile || {};
    return p.nom || u?.label || sellerId || "-";
  }
  function sellerAddress(sellerId){
    const u = getUser(sellerId);
    const p = state?.[sellerId]?.profile || u?.profile || {};
    return p.adresse || p.address || "-";
  }
  function openSellerModal(sellerId){
    const overlay = document.getElementById("sellerModal");
    const body = document.getElementById("sellerModalBody");
    if (!overlay || !body) return;
    body.innerHTML = `
      <div style="margin-bottom:8px">Nom : <b>${escapeHtml(sellerDisplayName(sellerId))}</b></div>
      <div>Adresse : <b>${escapeHtml(sellerAddress(sellerId))}</b></div>
    
      <div style="margin-top:12px">
        <iframe
          width="100%"
          height="220"
          style="border:0; border-radius:12px"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          src="https://www.google.com/maps?q=${encodeURIComponent(sellerAddress(sellerId))}&output=embed">
        </iframe>
      </div>
`;
    overlay.style.display = "flex";
  }
  function closeSellerModal(){
    const overlay = document.getElementById("sellerModal");
    if (overlay) overlay.style.display = "none";
  }

  document.addEventListener("click", (e) => {
    const link = e.target.closest(".sellerLink");
    if (link) {
      e.preventDefault();
      e.stopPropagation();
      const sellerId = link.dataset.sellerId;
      if (sellerId) openSellerModal(sellerId);
      return;
    }
    if (e.target && (e.target.id === "sellerModal")) closeSellerModal();
  });

  document.addEventListener("click", (e) => {
    if (e.target && e.target.id === "sellerModalClose") closeSellerModal();
  });



// ==========================
// GEO V3 CLEAN PATCH
// ==========================

const GEO_KEY = "geo.byUser.v1";
const GEO_RESERVED = 10;
const GEO_ZONE = 250;

function loadGeo(){ return JSON.parse(localStorage.getItem(GEO_KEY) || "{}"); }
function saveGeo(g){ localStorage.setItem(GEO_KEY, JSON.stringify(g)); }

function setGeo(userId, lat, lng){
  const g = loadGeo();
  g[userId] = {lat:Number(lat), lng:Number(lng), ts:Date.now()};
  saveGeo(g);
}

function getGeo(userId){
  return loadGeo()[userId] || null;
}

function haversine(lat1, lon1, lat2, lon2){
  const R = 6371000;
  const dLat = (lat2-lat1) * Math.PI/180;
  const dLon = (lon2-lon1) * Math.PI/180;
  const a = Math.sin(dLat/2)**2 +
            Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) *
            Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function computeDistanceForBuyer(offer, buyerId){
  const buyerGeo = getGeo(buyerId);
  const sellerGeo = getGeo(offer.sellerId);

  if(!buyerGeo || !sellerGeo) return null;

  return Math.round(
    haversine(
      buyerGeo.lat,
      buyerGeo.lng,
      sellerGeo.lat,
      sellerGeo.lng
    )
  );
}

function geoStatusForBuyerOffer(offer, buyerId){
  const b = getGeo(buyerId);
  const s = getGeo(offer.sellerId);
  if(!b || !s) return null;
  const d = haversine(b.lat,b.lng,s.lat,s.lng);
  if(d <= GEO_RESERVED) return "R√©serv√©";
  if(d <= GEO_ZONE) return "Zone";
  return null;
}

// Override status logic
displayBuyerOfferStatus = function(offer, buyerId){
  const tx = getTxStatus(offer.id, buyerId);
  if(tx === "Valid√©") return "Valid√©";
  return geoStatusForBuyerOffer(offer,buyerId);
};

// Buyer GPS button auto inject
document.addEventListener("click", e=>{
  if(e.target.id==="geoBuyerBtn"){
    navigator.geolocation.getCurrentPosition(pos=>{
      setGeo(userSelect.value,pos.coords.latitude,pos.coords.longitude);
      alert("Position mise √† jour");
    });
  }
});

// Vendor auto geocode
async function geoVendor(){
  const adr = document.getElementById("adr")?.value;
  if(!adr) return;
  const r = await fetch("https://nominatim.openstreetmap.org/search?format=json&limit=1&q="+encodeURIComponent(adr));
  const j = await r.json();
  if(j[0]){
    setGeo(userSelect.value,j[0].lat,j[0].lon);
    alert("Adresse g√©ocod√©e");
  }
}
document.addEventListener("click", e=>{
  if(e.target.id==="geoVendorBtn") geoVendor();
});

// Hide old Spot / Emplacement UI if still present
document.addEventListener("DOMContentLoaded", ()=>{
  document.querySelectorAll("label").forEach(l=>{
    if(l.textContent.includes("Spot") || l.textContent.includes("Emplacement")){
      l.closest("div")?.remove();
    }
  });
});



function publish() {

  const uId = userSelect.value;

  const type = document.getElementById("type")?.value || "";
  const value = document.getElementById("value")?.value || "";
  const qty   = document.getElementById("quantity")?.value || "";
  const date  = document.getElementById("date")?.value || "";

  if (!type || !value || !qty) {
    alert("Veuillez remplir tous les champs.");
    return;
  }

  const offers = JSON.parse(localStorage.getItem("offers") || "[]");

  const newOffer = {
    id: Date.now().toString(),
    sellerId: uId,
    type,
    value,
    quantity: qty,
    date,
    createdAt: Date.now()
  };

  offers.push(newOffer);

  localStorage.setItem("offers", JSON.stringify(offers));

  alert("Offre publi√©e ‚úÖ");

  if (typeof render === "function") render();
}

</script>

<style>
  .statusBox{
    position:absolute;
    top:12px;
    right:12px;
    z-index:2;
  }
</style>


<style>
  </style>


<style>
  /* Couleurs fortes pour le statut unique (prioritaire sur les styles existants) */
  .statusBox .pill{
    border: none !important;
  }
  .statusBox .pill[data-status="Valid√©"]{
    background-color: #1fa34a !important;
    color: #ffffff !important;
  }
  .statusBox .pill[data-status="R√©serv√©"]{
    background-color: #4da3ff !important;
    color: #ffffff !important;
  }
</style>


<style>
  .sellerLink{ cursor:pointer; text-decoration:underline; }
  .modalOverlay{
    position:fixed; inset:0; z-index:9999;
    background:rgba(0,0,0,.6);
    align-items:center; justify-content:center;
    padding:16px;
  }
  .modalCard{ max-width:420px; width:100%; }
  .ghostBtn{
    border:none; background:transparent; cursor:pointer;
    font-size:18px; line-height:1; padding:6px 10px;
    border-radius:10px;
  }
</style>


<style>
  /* Statut Valid√© en vert (offres acheteur) */
  .pill[data-status="Valid√©"]{
    background-color:#1fa34a !important;
    color:#ffffff !important;
    border:none !important;
  }
</style>


<style>
  /* Statut R√©serv√© en bleu clair (offres acheteur) */
  .pill[data-status="R√©serv√©"]{
    background-color:#4da3ff !important;
    color:#ffffff !important;
    border:none !important;
  }
</style>


<style>
.bottomNav{
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(255,255,255,.94);
  backdrop-filter: blur(10px);
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: space-around;
  gap: 8px;
  padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
  z-index: 999;
}

.bottomNav .tab{
  flex:1;
  font-size: 14px;
  padding: 10px 6px;
  border-radius: 12px;
  border: none;
  background: transparent;
  color: var(--muted);
}

.bottomNav .tab[aria-selected="true"]{
  background: rgba(37,99,235,.12);
  color: var(--primary);
  font-weight: 600;
}

main{
  padding-bottom: calc(92px + env(safe-area-inset-bottom));
}
</style>


<style>
/* SAFE MASK Spot & Emplacement */
#home_vendeur_spot,
#emplacement {
  display: none !important;
}

/* Hide associated labels safely */
label[for="home_vendeur_spot"],
label[for="emplacement"] {
  display: none !important;
}
</style>

<script src="https://unpkg.com/@zxing/library@latest"></script>
</head>
<body>

<div style="font-size:11px;color:#888;padding:6px 10px;">index_master_base_v4_auto_scan_square.html</div>


<header>
  <div class="row">
    <label for="userSelect">Utilisateur</label>
    <select id="userSelect"></select>
  </div>
  
</header>

<main id="content"></main>

<nav class="bottomNav" id="tabs"></nav>
<div class="toast" id="toast"></div>

<script>
  // =========================
  // Donn√©es / contextes
  // =========================
  const CONTEXTS = {
    vendeur: ["Home","Offres","Publish","Scan"],
    acheteur: ["Home","Offres","Favoris","QR"]
  };

  const USERS = [
    {id:"vendeur1",label:"Vendeur1",context:"vendeur",profile:{nom:"Paul Martin", adresse:"12 rue des Lilas, 75010 Paris"}, location:{lat:48.8721,lng:2.3656}},
    {id:"vendeur2",label:"Vendeur2",context:"vendeur",profile:{nom:"Claire Dubois", adresse:"48 avenue Victor Hugo, 69002 Lyon"}, location:{lat:45.7578,lng:4.8320}},
    {id:"acheteur1",label:"Acheteur1",context:"acheteur",profile:{nom:"Lucas Bernard", adresse:"5 boulevard de la R√©publique, 31000 Toulouse"}},
    {id:"acheteur2",label:"Acheteur2",context:"acheteur",profile:{nom:"Emma Lef√®vre", adresse:"22 rue Nationale, 59000 Lille"}},
  ];

  // =========================
  // LocalStorage keys
  // =========================
  const OFFERS_KEY      = "offers.reverse.v1";
  const OFFERS_SEQ_KEY  = "offers.seq.rev";
  const STATE_KEY       = "multiUserState.v1.base";
  const FAVS_KEY        = "favorites.byBuyer.v1";
  const VALID_KEY       = "validated.byBuyer.v1";
  const RESERVE_KEY     = "reserved.byBuyer.v1";
  const TX_STATUS_KEY = "txStatus.byOfferBuyer.v1"; // { offerId: { buyerId: "Valid√©" } }

  // =========================
  // Helpers JSON storage
  // =========================
  function loadJSON(key, fallback){
    try {
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : fallback;
    } catch {
      return fallback;
    }
  }
  function saveJSON(key, value){
    localStorage.setItem(key, JSON.stringify(value));
  }

  // Offres
  function loadOffers(){ return loadJSON(OFFERS_KEY, []); }
  function saveOffers(o){ saveJSON(OFFERS_KEY, o); }

  function nextOfferId(){
    if (globalThis.crypto && crypto.randomUUID) return crypto.randomUUID();
    let n = +localStorage.getItem(OFFERS_SEQ_KEY) || 0;
    n += 1; localStorage.setItem(OFFERS_SEQ_KEY, String(n));
    const ts = Date.now().toString(36);
    const rnd = Math.random().toString(36).slice(2, 8);
    return `off_${ts}_${n}_${rnd}`;
  }

  // =========================
  // State (tab + profile + buyerPrefs)
  // =========================
  const state = loadJSON(STATE_KEY, {});
  function saveState(){ saveJSON(STATE_KEY, state); }

  function getUser(id){ return USERS.find(u => u.id === id); }

  function ensureUser(u){
    state[u.id] ??= { tab: "Home", profile: { ...u.profile } };
    state[u.id].profile ??= { ...u.profile };

    // Acheteur: pr√©f√©rences persist√©es dans le state (m√™me logique que Nom/Adresse)
    if (u.context === "acheteur") {
      state[u.id].buyerPrefs ??= {};
      if (!("emplacement" in state[u.id].buyerPrefs)) state[u.id].buyerPrefs.emplacement = null;
      if (!Array.isArray(state[u.id].buyerPrefs.categories)) state[u.id].buyerPrefs.categories = [];
      if (typeof state[u.id].pointsFlash !== "number") state[u.id].pointsFlash = 0;
    }
    saveState();
  }

  // =========================
  // Favs / Valid / Reserve (par acheteur)
  // =========================
  function loadFavsAll(){ return loadJSON(FAVS_KEY, {}); }
  function saveFavsAll(obj){ saveJSON(FAVS_KEY, obj); }
  function isFav(buyerId, offerId){
    const all = loadFavsAll();
    return !!(all[buyerId] && all[buyerId][offerId]);
  }
  function setFav(buyerId, offerId, flag){
    const all = loadFavsAll();
    all[buyerId] ??= {};
    if (flag) all[buyerId][offerId] = true;
    else delete all[buyerId][offerId];
    saveFavsAll(all);
  }
  function favIdsForBuyer(buyerId){
    const all = loadFavsAll();
    return new Set(Object.keys(all[buyerId] || {}));
  }
  function countFavsForOffer(offerId){
    const all = loadFavsAll();
    let n = 0;
    for (const buyerId of Object.keys(all)) if (all[buyerId] && all[buyerId][offerId]) n += 1;
    return n;
  }

  // VALIDATION MANUELLE D√âSACTIV√âE
  // Le statut "Valid√©" provient UNIQUEMENT du scan vendeur (TX_STATUS_KEY)
  function isValid(){
    return false;
  }
  function setValid(){
    // no-op volontaire
  }
  function countValidForOffer(offerId){
    const all = loadTxAll();
    const buyers = all?.[offerId];
    if (!buyers) return 0;
    return Object.values(buyers).filter(v => v === "Valid√©").length;
  }

  function loadReserveAll(){ return loadJSON(RESERVE_KEY, {}); }
  function saveReserveAll(obj){ saveJSON(RESERVE_KEY, obj); }
  function isReserved(buyerId, offerId){
    const all = loadReserveAll();
    return !!(all[buyerId] && all[buyerId][offerId]);
  }
  function setReserved(buyerId, offerId, flag){
    const all = loadReserveAll();
    all[buyerId] ??= {};
    if (flag) all[buyerId][offerId] = true;
    else delete all[buyerId][offerId];
    saveReserveAll(all);
  }


  function loadTxAll(){ try { return JSON.parse(localStorage.getItem(TX_STATUS_KEY) || "{}"); } catch { return {}; } }
  function saveTxAll(obj){ localStorage.setItem(TX_STATUS_KEY, JSON.stringify(obj)); }
  function getTxStatus(offerId, buyerId){
    const all = loadTxAll();
    return all?.[offerId]?.[buyerId] || null;
  }
  function setTxStatus(offerId, buyerId, status){
    const all = loadTxAll();
    all[offerId] ??= {};
    if (status) all[offerId][buyerId] = status;
    else delete all[offerId][buyerId];
    saveTxAll(all);
  }


  // =========================
  // UI refs
  // =========================
  const userSelect = document.getElementById("userSelect");
  const tabsEl = document.getElementById("tabs");
  const content = document.getElementById("content");
  const toast = document.getElementById("toast");

  function showToast(text){
    toast.textContent = text;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1400);
  }

  function escapeHtml(str){
    return String(str ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  // =========================
  // Expiration / countdown
  // =========================
  function parseDateMs(d){ return d ? new Date(d).getTime() : null; }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  // --- Statut offre acheteur (calcul√©) ---
  function statut_offre_acheteur(emplacement, distance){
    if (emplacement == null || distance == null) return null;
    if (Number(distance) === Number(emplacement)) return "R√©serv√©";
    if (Math.abs(Number(emplacement) - Number(distance)) === 1) return "Zone";
    return null;
  }


  function displayBuyerOfferStatus(offer, buyerId){
    const tx = getTxStatus(offer.id, buyerId);
    if (tx === "Valid√©") return "Valid√©";
    const emp = state[buyerId]?.buyerPrefs?.emplacement ?? null;
    return statut_offre_acheteur(emp, offer.distance);
  }


  function countReservedBuyersForOffer(offer){
    let count = 0;
    for (const u of USERS) {
      if (u.context !== "acheteur") continue;
      const emp = state[u.id]?.buyerPrefs?.emplacement;
      const status = statut_offre_acheteur(emp, offer.distance);
      if (status === "R√©serv√©") count++;
    }
    return count;
  }



  // Progression 0..1 bas√©e sur (NOW - createdAt) / (expiresAt - createdAt)
  // Fallback: fen√™tre 24h avant expiration si createdAt absent.
  function expiryProgress(exp, createdAt){
    const end = parseDateMs(exp);
    if (!end) return 0;
    const now = Date.now();

    let start = Number(createdAt);
    if (!start || !Number.isFinite(start)) start = end - (1000 * 60 * 60 * 24);

    if (now <= start) return 0;
    if (now >= end) return 1;
    return clamp((now - start) / (end - start), 0, 1);
  }

  function remainingText(exp){
    const end = parseDateMs(exp);
    if (!end) return "--";
    let ms = end - Date.now();
    if (ms <= 0) return "0s";

    const totalSec = Math.floor(ms / 1000);

    const days = Math.floor(totalSec / 86400);
    const hours = Math.floor((totalSec % 86400) / 3600);
    const minutes = Math.floor((totalSec % 3600) / 60);
    const seconds = totalSec % 60;

    let parts = [];
    if (days > 0) parts.push(days + "j");
    if (hours > 0) parts.push(hours + "h");
    if (minutes > 0) parts.push(minutes + "m");
    if (seconds > 0 || parts.length === 0) parts.push(seconds + "s");

    return parts.join("");
}


  // --- Area (Emplacement - Distance) ---
  function computeArea(buyerId, offer){
    const emp = state?.[buyerId]?.buyerPrefs?.emplacement;
    const dist = offer?.distance;
    if (emp == null || dist == null) return null;
    const a = Math.abs(Number(emp) - Number(dist));
    if (!Number.isFinite(a)) return null;
    return a;
  }


  // =========================
  // Tabs
  // =========================
  function renderTabs(u){
    ensureUser(u);
    const tabs = CONTEXTS[u.context];
    if (!tabs.includes(state[u.id].tab)) state[u.id].tab = "Home";

    tabsEl.innerHTML = tabs.map(t =>
      `<button class="tab" data-tab="${t}" aria-selected="${t === state[u.id].tab}">${t}</button>`
    ).join("");

    [...tabsEl.querySelectorAll(".tab")].forEach(btn => {
      btn.addEventListener("click", () => {
        state[u.id].tab = btn.dataset.tab;
        saveState();
        render(u);
      });
    });
  }

  // =========================
  // Offers cards
  // =========================
  function renderOffers(u, mode){
    const allOffers = loadOffers();

    const selectedCats = (u.context === "acheteur")
      ? (state[u.id]?.buyerPrefs?.categories || [])
      : null;
    const catSet = (u.context === "acheteur") ? new Set(selectedCats) : null;

    let visible = [];
    if (u.context === "vendeur") {
      visible = allOffers.filter(o => o.sellerId === u.id);
    } else {
      const favs = favIdsForBuyer(u.id);
      if (mode === "favorites") visible = allOffers.filter(o => favs.has(o.id));
      else visible = allOffers.filter(o => !favs.has(o.id)); // Offres acheteur = NON favoris√©es

      // Filtre cat√©gories c√¥t√© acheteur (comportement inchang√©)
      if (catSet.size === 0) visible = [];
      else visible = visible.filter(o => catSet.has(o.category));
    }

    if (!visible.length) return ``;

    if (u.context === "acheteur") {
      visible.sort((a,b) => {
        const da = computeDistanceForBuyer(a, u.id);
        const db = computeDistanceForBuyer(b, u.id);

        if (da === null && db === null) return 0;
        if (da === null) return 1;
        if (db === null) return -1;

        return da - db;
      });
    } else {
      visible.sort((a,b)=> (b.createdAt||0) - (a.createdAt||0));
    }

    return `
      <div class="offers">
        ${visible.map(o => `
          <div class="offer" data-id="${escapeHtml(o.id)}" data-created="${escapeHtml(o.createdAt || "")}">
            <div class="top">
              ${u.context === "acheteur"
                ? `
                  <div style="margin-bottom:12px; display:flex; flex-direction:column; align-items:flex-start; gap:6px">
                    ${(() => {
                      try{
                        const imgs = JSON.parse(localStorage.getItem("vendor.image.v1") || "{}");
                        const img = imgs[o.sellerId] || null;
                        if (img) {
                          return `
                            <div style="width:70px;height:70px;border-radius:14px;overflow:hidden">
                              <img src="${img}" style="width:100%;height:100%;object-fit:cover">
                            </div>
                          `;
                        }
                      }catch(e){}
                      return ``;
                    })()}
                    <div style="font-weight:600">
                      <span class="sellerLink" data-seller-id="${escapeHtml(o.sellerId)}">
                        ${escapeHtml(o.sellerName || "-")}
                      </span>
                    </div>
                  </div>
                `
                : ``}

              <div>
                ${u.context === "acheteur"
                  ? `<div class="offerTitle">
${o.type === "Offre" 
  ? `${escapeHtml(o.value)}` 
  : `${escapeHtml(o.type)} : ${escapeHtml(o.value)}`}
</div>`
                  : `<span class="pill">${escapeHtml(o.type)}</span>
                     <span class="pill">${escapeHtml(o.value)}</span>`
                }
                ${u.context === "vendeur"
                  ? (o.quantity === "Illimit√©"
                      ? ``
                      : `
                         <span class="pill">Restant: ${escapeHtml(Math.max(0, (Number(o.quantity) || 0) - countValidForOffer(o.id)))}/${escapeHtml(o.quantity ?? "-")}</span>`)
                  : `<span class="pill">Restant: ${escapeHtml(Math.max(0, (Number(o.quantity) || 0) - countValidForOffer(o.id)))}/${escapeHtml(o.quantity ?? "-")}</span>`
                }
                ${u.context === "acheteur"
  ? `
     ${(() => {
        const a = computeArea(u.id, o);
        return a !== null ? `<span class="pill">Area: ${escapeHtml(a)}</span>` : ``;
     })()}
    `
  : ``}
                ${u.context === "acheteur"
                  ? ``
                  : ``}
                <span class="pill">${escapeHtml(o.category)}</span>
                ${u.context === "acheteur" ? `
                  
                ` : ``}
              </div>

              ${u.context === "acheteur" ? `
                <div style="display:flex; flex-direction:column; align-items:flex-end; gap:6px">
                  
                ${(() => { const s = displayBuyerOfferStatus(o, u.id); return s ? `<span class="pill" data-status="${s}">${s}</span>` : ``; })()}
                ${(() => { const s = displayBuyerOfferStatus(o, u.id); return s ? `<div class="statusBox"><span class="pill" data-status="${s}">${s}</span></div>` : ``; })()}
                <svg class="ring" viewBox="0 0 100 100" data-exp="${escapeHtml(o.date || "")}">
                    <circle class="bg" cx="50" cy="50" r="45"></circle>
                    <circle class="fg" cx="50" cy="50" r="45"
                      stroke-dasharray="${2 * Math.PI * 45}"
                      stroke-dashoffset="${2 * Math.PI * 45 * (1 - expiryProgress(o.date, o.createdAt))}">
                    </circle>
                  </svg>
                  <div class="countdown" data-exp="${escapeHtml(o.date || "")}">${remainingText(o.date)}</div>
                  ${(() => {
                    const d = computeDistanceForBuyer(o, u.id);
                    return `<div style="font-size:13px;margin-top:4px;color:#334155">
                              üìç ${d !== null ? d + " m" : "-"}
                            </div>`;
                  })()}
                </div>
              ` : `
                <div class="date">Expire : ${escapeHtml(o.date || "-")}</div>
              `}
            </div>

            <div class="meta">
              <div>
                ${u.context === "vendeur"
                  ? `‚≠ê Favori : <b>${countFavsForOffer(o.id)}</b> ¬∑ üü° R√©serv√© : <b>${countReservedBuyersForOffer(o)}</b> ¬∑ ‚úÖ Valid√© : <b>${countValidForOffer(o.id)}</b>`
                  : `${o.description ? `<div><button class="descBtn" data-id="${escapeHtml(o.id)}">Description</button></div>` : ``}`
                }
              </div>

              ${u.context === "acheteur" ? `
                <div style="display:flex; gap:8px; flex-wrap:wrap">
<button class="heartToggle" data-id="${escapeHtml(o.id)}" style="border:none;background:transparent;font-size:20px;cursor:pointer">
  ${isFav(u.id, o.id) ? "üíñ" : "ü§ç"}
</button>

                  
                  
                  
                </div>
              ` : ""}
            </div>
          
              ${u.context === "acheteur" ? `
                <div class="offerDesc" id="desc-${escapeHtml(o.id)}">
                  ${escapeHtml(o.description || "Aucune description")}
                </div>
              ` : ``}
            </div>
        `).join("")}
      </div>
    `;

  }

  function wireToggles(u){
    // Favori coeur
    document.querySelectorAll(".heartToggle").forEach(btn => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const id = btn.getAttribute("data-id");
        const current = isFav(u.id, id);
        setFav(u.id, id, !current);
        btn.textContent = !current ? "üíñ" : "ü§ç";
        showToast(!current ? "Ajout√© aux favoris üíñ" : "Retir√© des favoris");
      });
    });

    // R√©server
    document.querySelectorAll(".resToggle").forEach(cb => {
      cb.addEventListener("click", (e) => e.stopPropagation());
      cb.addEventListener("change", () => {
        const id = cb.getAttribute("data-id");
        const checked = cb.checked;
        setReserved(u.id, id, checked);
        showToast(checked ? "Offre r√©serv√©e üìå" : "R√©servation annul√©e");
      });
    });

    // Validation manuelle d√©sactiv√©e (scan vendeur uniquement)
  }

  // =========================
  // Home render helpers
  // =========================
  
function renderHome(u){

  const geoData = JSON.parse(localStorage.getItem("geo.byUser.v1") || "{}");
  const geo = geoData[u.id] || null;
  const latDisplay = geo ? Number(geo.lat).toFixed(6) : "-";
  const lngDisplay = geo ? Number(geo.lng).toFixed(6) : "-";

    const p = state[u.id].profile;
    const isVendeur = (u.context === "vendeur");

    content.innerHTML = `
      <div class="card">
        

        <div class="fields">
          <div>
            <label>Nom</label>
            <input id="nom" value="${escapeHtml(p.nom || "")}">
          </div>
          <div>
            <label>Adresse</label>
            <input id="adr" value="${escapeHtml(p.adresse || "")}">

${u.context === "vendeur" ? `
<button id="geoVendorBtn" class="primary" style="margin-top:10px;">
  üó∫Ô∏è G√©ocoder l‚Äôadresse
</button>
<div id="geoVendorCoords" style="font-size:12px;margin-top:6px;">
  Lat: ${latDisplay} | Lng: ${lngDisplay}
</div>
` : ``}

${u.context === "acheteur" ? `
<button id="geoBuyerBtn" class="primary" style="margin-top:10px;">
  üìç Utiliser ma position
</button>
<div id="geoBuyerCoords" style="font-size:12px;margin-top:6px;">
  Lat: ${latDisplay} | Lng: ${lngDisplay}
</div>
` : ``}

          </div>
        </div>

        ${isVendeur ? `
          <div>
            <label>Spot</label>
            <select id="home_vendeur_spot">
              <option value="">-- choisir --</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>

          <div style="margin-top:16px">
            <div class="muted" style="margin-bottom:8px">Emplacement du vendeur</div>
            <div id="map" style="height:320px;width:100%;border-radius:12px;overflow:hidden"></div>
          </div>
        ` : ``}

        ${u.context === "acheteur" ? `
          <div style="margin-top:16px">
            <label>Emplacement</label>
            <select id="emplacement">
              <option value="">-- choisir --</option>
              ${Array.from({length:5},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join("")}
            </select>
          </div>

          <div style="margin-top:16px">
            <label>Points Flash</label>
            <input id="pointsFlash" value="${state[u.id].pointsFlash ?? 0}" readonly>
          </div>

          <div style="margin-top:16px">
            <div class="muted" style="margin-bottom:8px">Cat√©gories</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              ${["Mode","Concert","Alimentation","Sport"].map(c=>`
                <label class="toggleBox" style="cursor:pointer">
                  <input type="checkbox" class="catToggle" value="${c}">
                  <span>${c}</span>
                </label>
              `).join("")}
            </div>
          </div>
        ` : ``}
      </div>
    `;

    // Profil (inchang√©)
    document.getElementById("nom").addEventListener("input", e => {
      state[u.id].profile.nom = e.target.value;
      saveState();
    });
    document.getElementById("adr").addEventListener("input", e => {
      state[u.id].profile.adresse = e.target.value;
      saveState();
    });

    // Acheteur prefs (m√™me logique que Nom/Adresse, mais s√©par√© et fiable)
    if (u.context === "acheteur") {
      const prefs = state[u.id].buyerPrefs;

      const emp = document.getElementById("emplacement");
      if (emp) {
        const saved = prefs.emplacement;
        emp.value = (saved === undefined || saved === null) ? "" : String(saved);
        emp.addEventListener("change", (e) => {
          const v = e.target.value;
          prefs.emplacement = (v === "" ? null : Number(v));
          saveState();
        });
      }

      document.querySelectorAll(".catToggle").forEach(cb => {
        cb.checked = prefs.categories.includes(cb.value);
        cb.addEventListener("change", () => {
          const set = new Set(prefs.categories);
          cb.checked ? set.add(cb.value) : set.delete(cb.value);
          prefs.categories = Array.from(set);
          saveState();
        });
      });
    }

    
    // Champ SAFE : Spot vendeur
    if (u.context === "vendeur") {
      const spotEl = document.getElementById("home_vendeur_spot");
      if (spotEl) {
        spotEl.value = state[u.id].profile?.spot ?? "";
        spotEl.addEventListener("change", e => {
          state[u.id].profile.spot = e.target.value ? Number(e.target.value) : null;
          saveState();
        });
      }
    }

// Carte vendeur (inchang√©)
    if (isVendeur && u.location) {
      setTimeout(() => initVendorMap(u, p), 50);
    }
  }

  function initVendorMap(u, p){
    // Remove previous instance if any
    if (window._leafletMap) {
      window._leafletMap.remove();
      window._leafletMap = null;
    }
    const map = L.map("map").setView([u.location.lat, u.location.lng], 13);
    window._leafletMap = map;

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap"
    }).addTo(map);

    L.marker([u.location.lat, u.location.lng])
      .addTo(map)
      .bindPopup(`<b>${escapeHtml(p.nom)}</b><br>${escapeHtml(p.adresse)}`)
      .openPopup();

    setTimeout(() => map.invalidateSize(), 200);
  }

  // =========================
  // Main render
  // =========================
  function render(u){
    ensureUser(u);
    renderTabs(u);

    const tab = state[u.id].tab;

    if (tab === "Home") {
      renderHome(u);
      return;
    }

    if (tab === "Publish") {
      if (u.context !== "vendeur") {
        content.innerHTML = `<div class="card"></div>`;
        return;
      }

      content.innerHTML = `
        <div class="card">
          
          

          <div class="fields">
            <div>
              <label>Type offre</label>
              <select id="type">
                <option value="">-- choisir --</option>
                <option value="Remise">Remise</option>
                <option value="Offre">Offre</option>
              </select>
            </div>
            <div>
              <label>Valeur</label>
              <div id="valueContainer"></div>
            </div>
            <div>
              <label>Quantit√©</label>
              <div id="qtyContainer"></div>
            </div>
            
            <div>
              <label>Cat√©gorie</label>
              <select id="cat">
                <option value="">-- choisir --</option>
                ${["Mode","Concert","Alimentation","Sport"].map(c => `<option value="${c}">${c}</option>`).join("")}
              </select>
            </div>
            <div>
              <label>Date expiration</label>
              <input type="datetime-local" id="date">
            </div>
          </div>

          
          <div style="grid-column:1 / -1">
            <label>Description</label>
            <textarea id="description"border-radius:10px;background:var(--card);color:var(--text);
              border:1px solid rgba(255,255,255,.15);padding:10px"></textarea>
          </div>

<div class="actions">
            <button class="primary" id="pub">Publier</button>
          </div>

          <div id="msg" class="muted" style="margin-top:10px"></div>
        </div>
      `;

      const msg = document.getElementById("msg");
      
      const typeEl = document.getElementById("type");
      const valueContainer = document.getElementById("valueContainer");

      function renderValueField(){
        if (typeEl.value === "Offre") {
          valueContainer.innerHTML = `
            <div class="valueBlock">
              <div class="field">
                <input id="value" placeholder="Valeur">
              </div>
              <div class="valueRow">
                <div class="field">
                  <label>Minimum d‚Äôachat (‚Ç¨)</label>
                  <input id="minBuy" type="number" min="0" step="1" placeholder="‚Ç¨">
                </div>
                <div class="field">
                  <label>Maximum d‚Äôachat (‚Ç¨)</label>
                  <input id="limit" type="number" min="0" step="1" placeholder="‚Ç¨">
                </div>
              </div>
            </div>
          `;
          return;
        }

        // Mode Remise
        valueContainer.innerHTML = `
          <div class="valueBlock">
            <div class="field">
              <select id="value">
                <option value="">-- choisir --</option>
                ${[10,20,30,40,50,60,70,80].map(v => `<option value="${v}%">${v}%</option>`).join("")}
                <option value="__autre__">Autre</option>
              </select>
            </div>

            <div class="valueRow">
              <div class="field">
                <label>Minimum d‚Äôachat (‚Ç¨)</label>
                <input id="minBuy" type="number" min="0" step="1" placeholder="‚Ç¨">
              </div>
              <div class="field">
                <label>Maximum d‚Äôachat (‚Ç¨)</label>
                <input id="limit" type="number" min="0" step="1" placeholder="‚Ç¨">
              </div>
            </div>
          </div>
        `;

        const valueEl = document.getElementById("value");
        valueEl.addEventListener("change", () => {
          if (valueEl.value === "__autre__") {
            valueContainer.innerHTML = `
              <div class="valueBlock">
                <div class="field">
                  <div style="display:flex;gap:6px;align-items:center">
                    <input
                      id="value"
                      type="number"
                      min="0"
                      step="1"
                      placeholder="Valeur"
                      style="flex:1"
                    >
                    <span class="pill">%</span>
                  </div>
                </div>

                <div class="valueRow">
                  <div class="field">
                    <label>Minimum d‚Äôachat (‚Ç¨)</label>
                    <input id="minBuy" type="number" min="0" step="1" placeholder="‚Ç¨">
                  </div>
                  <div class="field">
                    <label>Maximum d‚Äôachat (‚Ç¨)</label>
                    <input id="limit" type="number" min="0" step="1" placeholder="‚Ç¨">
                  </div>
                </div>
              </div>
            `;
          }
        });
      }

      typeEl.addEventListener("change", renderValueField);
      renderValueField();


      const qtyContainer = document.getElementById("qtyContainer");

      function renderQtyField(){
        qtyContainer.innerHTML = `
          <select id="qty">
            ${Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join("")}
            <option value="__autre__">Autre</option>
            <option value="__illimite__">Illimit√©</option>
          </select>
        `;

        const qtyEl = document.getElementById("qty");
        qtyEl.addEventListener("change", () => {
          if (qtyEl.value === "__autre__") {
            qtyContainer.innerHTML = `
              <input
                id="qty"
                type="number"
                min="1"
                step="1"
                placeholder="Quantit√©"
              >
            `;
          }
        });
      }

      renderQtyField();

document.getElementById("pub").addEventListener("click", () => {
        const type = document.getElementById("type").value;
        let value = document.getElementById("value").value;
        if (type === "Remise" && value && !String(value).includes("%")) {
          value = value + "%";
        }
        let qty = document.getElementById("qty").value;

        // Illimit√© accept√© comme valeur m√©tier
        if (qty === "__illimite__") {
          qty = "Illimit√©";
        }

        // Validation num√©rique uniquement si ce n‚Äôest pas Illimit√©
        if (qty !== "Illimit√©") {
          if (isNaN(qty) || Number(qty) <= 0) {
            return msg.textContent = "‚ö†Ô∏è Quantit√© invalide";
          }
          qty = Number(qty);
        }
        const cat = document.getElementById("cat").value;
        const date = document.getElementById("date").value;
        const description = document.getElementById("description")?.value || "";

        if (!type) return msg.textContent = "‚ö†Ô∏è Choisir un type";
        if (!value) return msg.textContent = "‚ö†Ô∏è Choisir une valeur";
        if (!qty || qty <= 0) return msg.textContent = "‚ö†Ô∏è Choisir une quantit√© valide";
        if (!cat) return msg.textContent = "‚ö†Ô∏è Choisir une cat√©gorie";
        if (!date) return msg.textContent = "‚ö†Ô∏è Choisir une date d‚Äôexpiration";

        const offers = loadOffers();
        offers.push({
          id: nextOfferId(),
          sellerId: u.id,
          sellerName: state[u.id].profile?.nom || u.profile.nom || u.label,
          type,
          value,
          quantity: Number(qty),
          category: cat,
          date,
          createdAt: Date.now(),
          description
        });
        saveOffers(offers);

        state[u.id].tab = "Offres";
        saveState();
        showToast("Offre publi√©e ‚úÖ");
        render(u);
      });

      return;
    }

    if (tab === "Offres") {
      content.innerHTML = `
        <div class="card">
          
          
          ${renderOffers(u, "all")}
        </div>
      `;
      if (u.context === "acheteur") wireToggles(u);
      return;
    }

    if (tab === "Favoris") {
      if (u.context !== "acheteur") {
        content.innerHTML = `<div class="card"></div>`;
        return;
      }

      content.innerHTML = `
        <div class="card">
          
          
          ${renderOffers(u, "favorites")}
        </div>
      `;
      wireToggles(u);
      return;
    }


    

    if (tab === "QR") {
      if (u.context !== "acheteur") {
        content.innerHTML = `<div class="card"></div>`;
        return;
      }

      let qrSrc = "";
      if (u.id === "acheteur1") {
        qrSrc = "data:image/png;base64,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";
      } else if (u.id === "acheteur2") {
        qrSrc = "data:image/png;base64,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";
      }

      content.innerHTML = `
        <div class="card" style="text-align:center">
          <h2>üî≥ Mon QR</h2>
          <img src="${qrSrc}" 
               style="width:200px;height:200px;margin-top:20px;border-radius:12px"/>
        </div>
      `;

      return;
    }

    if (tab === "Scan") {
      setTimeout(() => {
        if (typeof startScanner === "function") {
          startScanner();
        }
      }, 0);

  if (u.context !== "vendeur") {
    content.innerHTML = `<div class="card"></div>`;
    return;
  }

  content.innerHTML = `
    <div class="card" style="text-align:center">
      <h2>üì∑ Scanner QR</h2>

      <video id="video" muted playsinline 
        style="width:100%;max-width:350px;border-radius:12px"></video>

      <br><br>

      <button id="startScan" class="primary">D√©marrer Scan</button>
      <button id="stopScan" class="primary" style="background:#64748b;margin-left:8px">Stop</button>
      

      
    </div>
  `;

  initQrScanner();
  return;
}


    // fallback
    content.innerHTML = `<div class="card"></div>`;
  }

  
  // Toggle offer description (buyer)
  document.addEventListener("click", (e) => {
    const btn = e.target.closest(".descBtn");
    if (!btn) return;
    const id = btn.dataset.id;
    const desc = document.getElementById("desc-" + id);
    if (!desc) return;
    desc.classList.toggle("open");
  });


  // =========================
  // Countdown rings update
  // =========================
  function updateRings(){
    document.querySelectorAll('.ring').forEach(svg=>{
      const exp = svg.getAttribute('data-exp');
      const offerEl = svg.closest('.offer');
      const createdAt = offerEl ? Number(offerEl.getAttribute('data-created')) : null;

      const p = expiryProgress(exp, createdAt);
      const r = 45;
      const c = 2 * Math.PI * r;
      const fg = svg.querySelector('.fg');
      if (fg) fg.style.strokeDashoffset = c * (1 - p);
    });

    document.querySelectorAll('.countdown').forEach(el=>{
      const exp = el.getAttribute('data-exp');
      el.textContent = remainingText(exp);
    });
  }

  // =========================
  // Boot
  // =========================
  userSelect.innerHTML = USERS.map(u => `<option value="${u.id}">${u.label}</option>`).join("");

  userSelect.addEventListener("change", () => render(getUser(userSelect.value)));
  userSelect.value = USERS[0].id;

  render(getUser(userSelect.value));
  updateRings();
  setInterval(updateRings, 1000);

  // --- Seller modal (buyer offer -> click seller name) ---
  function sellerDisplayName(sellerId){
    const u = getUser(sellerId);
    const p = state?.[sellerId]?.profile || u?.profile || {};
    return p.nom || u?.label || sellerId || "-";
  }
  function sellerAddress(sellerId){
    const u = getUser(sellerId);
    const p = state?.[sellerId]?.profile || u?.profile || {};
    return p.adresse || p.address || "-";
  }
  function openSellerModal(sellerId){
    const overlay = document.getElementById("sellerModal");
    const body = document.getElementById("sellerModalBody");
    if (!overlay || !body) return;
    body.innerHTML = `
      <div style="margin-bottom:8px">Nom : <b>${escapeHtml(sellerDisplayName(sellerId))}</b></div>
      <div>Adresse : <b>${escapeHtml(sellerAddress(sellerId))}</b></div>
    
      <div style="margin-top:12px">
        <iframe
          width="100%"
          height="220"
          style="border:0; border-radius:12px"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          src="https://www.google.com/maps?q=${encodeURIComponent(sellerAddress(sellerId))}&output=embed">
        </iframe>
      </div>
`;
    overlay.style.display = "flex";
  }
  function closeSellerModal(){
    const overlay = document.getElementById("sellerModal");
    if (overlay) overlay.style.display = "none";
  }

  document.addEventListener("click", (e) => {
    const link = e.target.closest(".sellerLink");
    if (link) {
      e.preventDefault();
      e.stopPropagation();
      const sellerId = link.dataset.sellerId;
      if (sellerId) openSellerModal(sellerId);
      return;
    }
    if (e.target && (e.target.id === "sellerModal")) closeSellerModal();
  });

  document.addEventListener("click", (e) => {
    if (e.target && e.target.id === "sellerModalClose") closeSellerModal();
  });



// ==========================
// GEO V3 CLEAN PATCH
// ==========================

const GEO_KEY = "geo.byUser.v1";
const GEO_RESERVED = 10;
const GEO_ZONE = 250;

function loadGeo(){ return JSON.parse(localStorage.getItem(GEO_KEY) || "{}"); }
function saveGeo(g){ localStorage.setItem(GEO_KEY, JSON.stringify(g)); }

function setGeo(userId, lat, lng){
  const g = loadGeo();
  g[userId] = {lat:Number(lat), lng:Number(lng), ts:Date.now()};
  saveGeo(g);
}

function getGeo(userId){
  return loadGeo()[userId] || null;
}

function haversine(lat1, lon1, lat2, lon2){
  const R = 6371000;
  const dLat = (lat2-lat1) * Math.PI/180;
  const dLon = (lon2-lon1) * Math.PI/180;
  const a = Math.sin(dLat/2)**2 +
            Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) *
            Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function computeDistanceForBuyer(offer, buyerId){
  const buyerGeo = getGeo(buyerId);
  const sellerGeo = getGeo(offer.sellerId);

  if(!buyerGeo || !sellerGeo) return null;

  return Math.round(
    haversine(
      buyerGeo.lat,
      buyerGeo.lng,
      sellerGeo.lat,
      sellerGeo.lng
    )
  );
}

function geoStatusForBuyerOffer(offer, buyerId){
  const b = getGeo(buyerId);
  const s = getGeo(offer.sellerId);
  if(!b || !s) return null;
  const d = haversine(b.lat,b.lng,s.lat,s.lng);
  if(d <= GEO_RESERVED) return "R√©serv√©";
  if(d <= GEO_ZONE) return "Zone";
  return null;
}

// Override status logic
displayBuyerOfferStatus = function(offer, buyerId){
  const tx = getTxStatus(offer.id, buyerId);
  if(tx === "Valid√©") return "Valid√©";
  return geoStatusForBuyerOffer(offer,buyerId);
};

// Buyer GPS button auto inject
document.addEventListener("click", e=>{
  if(e.target.id==="geoBuyerBtn"){
    navigator.geolocation.getCurrentPosition(pos=>{
      setGeo(userSelect.value,pos.coords.latitude,pos.coords.longitude);
      alert("Position mise √† jour");
    });
  }
});

// Vendor auto geocode
async function geoVendor(){
  const adr = document.getElementById("adr")?.value;
  if(!adr) return;
  const r = await fetch("https://nominatim.openstreetmap.org/search?format=json&limit=1&q="+encodeURIComponent(adr));
  const j = await r.json();
  if(j[0]){
    setGeo(userSelect.value,j[0].lat,j[0].lon);
    alert("Adresse g√©ocod√©e");
  }
}
document.addEventListener("click", e=>{
  if(e.target.id==="geoVendorBtn") geoVendor();
});

// Hide old Spot / Emplacement UI if still present
document.addEventListener("DOMContentLoaded", ()=>{
  document.querySelectorAll("label").forEach(l=>{
    if(l.textContent.includes("Spot") || l.textContent.includes("Emplacement")){
      l.closest("div")?.remove();
    }
  });
});


</script>

  <div id="sellerModal" class="modalOverlay" style="display:none">
    <div class="modalCard card">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px">
        <div style="font-weight:800">Vendeur</div>
        <button id="sellerModalClose" class="ghostBtn" aria-label="Fermer">‚úï</button>
      </div>
      <div id="sellerModalBody" style="margin-top:10px"></div>
    </div>
  </div>

<script>
const GEO_KEY="geo.byUser.v1";

function loadGeo(){ return JSON.parse(localStorage.getItem(GEO_KEY)||"{}"); }
function saveGeo(g){ localStorage.setItem(GEO_KEY,JSON.stringify(g)); }
function setGeo(id,lat,lng){
  const g=loadGeo();
  g[id]={lat:Number(lat),lng:Number(lng)};
  saveGeo(g);
}

document.addEventListener("click", async (e)=>{

  if(e.target.id==="geoVendorBtn"){
    const uId=userSelect.value;
    const adr=document.getElementById("adr").value;
    if(!adr) return alert("Adresse vide");
    const r=await fetch("https://nominatim.openstreetmap.org/search?format=json&limit=1&q="+encodeURIComponent(adr));
    const j=await r.json();
    if(j[0]){
      setGeo(uId,j[0].lat,j[0].lon);
      document.getElementById("geoVendorCoords").textContent=
        "Lat: "+Number(j[0].lat).toFixed(6)+" | Lng: "+Number(j[0].lon).toFixed(6);
    } else alert("Adresse introuvable");
  }

  if(e.target.id==="geoBuyerBtn"){
    const uId=userSelect.value;
    if(!navigator.geolocation) return alert("Non support√©");
    navigator.geolocation.getCurrentPosition(pos=>{
      setGeo(uId,pos.coords.latitude,pos.coords.longitude);
      document.getElementById("geoBuyerCoords").textContent=
        "Lat: "+pos.coords.latitude.toFixed(6)+" | Lng: "+pos.coords.longitude.toFixed(6);
    });
  }

});
</script>


<script>
// ===== BUYER GEO SAFE (NON-DESTRUCTIVE) =====

const GEO_KEY = "geo.buyer.v1";

function saveBuyerGeo(lat, lng){
  localStorage.setItem(GEO_KEY, JSON.stringify({
    lat: Number(lat),
    lng: Number(lng),
    ts: Date.now()
  }));
}

function loadBuyerGeo(){
  try {
    return JSON.parse(localStorage.getItem(GEO_KEY));
  } catch {
    return null;
  }
}

function getBuyerPosition(){
  if(!navigator.geolocation){
    alert("G√©olocalisation non support√©e");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos=>{
    saveBuyerGeo(pos.coords.latitude, pos.coords.longitude);
    render(getUser(userSelect.value));
  });
}

function enhanceBuyerHome(){
  const u = getUser(userSelect.value);
  if(!u || u.context !== "acheteur") return;

  const adrInput = document.getElementById("adr");
  if(!adrInput) return;

  if(document.getElementById("buyerGeoBlock")) return;

  const wrapper = document.createElement("div");
  wrapper.id = "buyerGeoBlock";
  wrapper.style.marginTop = "10px";

  const btn = document.createElement("button");
  btn.textContent = "üìç Utiliser ma position";
  btn.onclick = getBuyerPosition;

  const display = document.createElement("div");
  display.style.fontSize = "12px";
  display.style.marginTop = "6px";

  const geo = loadBuyerGeo();
  display.textContent = geo
    ? "Lat: " + geo.lat.toFixed(6) + " | Lng: " + geo.lng.toFixed(6)
    : "Lat: - | Lng: -";

  wrapper.appendChild(btn);
  wrapper.appendChild(display);

  adrInput.parentNode.insertBefore(wrapper, adrInput.nextSibling);
}

// Hook after render (safe wrap)
const _render_original = render;
render = function(){
  _render_original.apply(this, arguments);
  setTimeout(enhanceBuyerHome, 0);
};
</script>


<script>
let codeReader;
let videoElement;

function initQrScanner(){
  videoElement = document.getElementById('video');
  

  document.getElementById("startScan").onclick = startScanner;
  document.getElementById("stopScan").onclick = stopScanner;
  
}

async function startScanner(){
  codeReader = new ZXing.BrowserQRCodeReader();
  try {
    codeReader.decodeFromVideoDevice(null, videoElement, (result, err) => {
      

if (result) {

        const buyerId = result.text.trim();
        const vendeur = getUser(userSelect.value);
        const offers = loadOffers();

        let validated = false;

        for (const o of offers) {

          const currentStatus = getTxStatus(o.id, buyerId);

          if (
            o.sellerId === vendeur.id &&
            geoStatusForBuyerOffer(o, buyerId) === "R√©serv√©" &&
            currentStatus !== "Valid√©"
          ) {

            setTxStatus(o.id, buyerId, "Valid√©");

            // üî• +1 Point Flash (only if not already validated)
            state[buyerId].pointsFlash = (state[buyerId].pointsFlash || 0) + 1;
            saveState();

            validated = true;
            break;
          }

        }

        if (validated) {
          alert("‚úÖ Offre valid√©e +1 Point Flash");
        } else {
          alert("‚ö†Ô∏è Aucune offre R√©serv√©e trouv√©e ou d√©j√† valid√©e");
        }

        stopScanner();
        render(getUser(userSelect.value));
      }


    });
  } catch (err) {
    alert("Erreur cam√©ra : " + err);
  }
}

function stopScanner(){
  if (codeReader) codeReader.reset();
}



</script>


<script>
// ===============================
// VENDOR IMAGE EXTENSION (SAFE)
// ===============================
(function(){

  const VENDOR_IMG_KEY = "vendor.image.v1";

  function loadVendorImages(){
    try { return JSON.parse(localStorage.getItem(VENDOR_IMG_KEY) || "{}"); }
    catch { return {}; }
  }

  function saveVendorImages(obj){
    localStorage.setItem(VENDOR_IMG_KEY, JSON.stringify(obj));
  }

  function setVendorImage(userId, dataUrl){
    const imgs = loadVendorImages();
    imgs[userId] = dataUrl;
    saveVendorImages(imgs);
  }

  function getVendorImage(userId){
    return loadVendorImages()[userId] || null;
  }

  function handleVendorImageUpload(file){
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(e){
      const img = new Image();
      img.onload = function(){

        const size = Math.min(img.width, img.height);
        const sx = (img.width - size) / 2;
        const sy = (img.height - size) / 2;

        const canvas = document.createElement("canvas");
        canvas.width = 300;
        canvas.height = 300;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, sx, sy, size, size, 0, 0, 300, 300);

        const cropped = canvas.toDataURL("image/jpeg", 0.85);
        setVendorImage(userSelect.value, cropped);

        injectVendorImageBlock();
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  function injectVendorImageBlock(){

    const u = USERS.find(x => x.id === userSelect.value);
    if(!u || u.context !== "vendeur") return;
    if(state[u.id]?.tab !== "Home") return;

    const card = document.querySelector("#content .card");
    if(!card) return;

    if(document.getElementById("vendorImageBlock")) return;

    const wrapper = document.createElement("div");
    wrapper.id = "vendorImageBlock";
    wrapper.style.display = "flex";
    wrapper.style.justifyContent = "center";
    wrapper.style.marginBottom = "16px";

    const imgData = getVendorImage(u.id);

    if(imgData){
      wrapper.innerHTML = `
        <div style="position:relative;width:140px;height:140px">
          <img src="${imgData}"
               style="width:100%;height:100%;object-fit:cover;border-radius:14px;border:1px solid #e2e8f0">
          <button style="position:absolute;bottom:6px;right:6px;border:none;border-radius:50%;
                         width:30px;height:30px;background:#2563eb;color:white;cursor:pointer">‚úèÔ∏è</button>
          <input type="file" accept="image/*" style="display:none">
        </div>
      `;
      const btn = wrapper.querySelector("button");
      const input = wrapper.querySelector("input");
      btn.onclick = () => input.click();
      input.onchange = (e) => handleVendorImageUpload(e.target.files[0]);
    } else {
      wrapper.innerHTML = `
        <label style="width:140px;height:140px;border:2px dashed #cbd5e1;
                      border-radius:14px;display:flex;align-items:center;
                      justify-content:center;cursor:pointer;
                      text-align:center;font-size:13px;color:#64748b">
          üì∑ Ajouter image<br>du commerce
          <input type="file" accept="image/*" style="display:none">
        </label>
      `;
      const input = wrapper.querySelector("input");
      input.onchange = (e) => handleVendorImageUpload(e.target.files[0]);
    }

    card.insertBefore(wrapper, card.firstChild);
  }

  const observer = new MutationObserver(() => {
    injectVendorImageBlock();
  });

  observer.observe(document.getElementById("content"), { childList: true });

})();
</script>

</body>
</html>
