<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scanner QR4</title>

<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 20px;
  background: #f4f6f8;
}

video {
  width: 100%;
  max-width: 350px;
  border-radius: 12px;
}

button {
  padding: 14px 20px;
  margin: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #0078D4;
  color: white;
  cursor: pointer;
}

ul {
  list-style: none;
  padding: 0;
  max-width: 400px;
  margin: 20px auto;
  text-align: left;
}

li {
  background: white;
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 4px;
  font-size: 14px;
  word-break: break-all;
}
</style>
</head>

<body>

<h2>ðŸ“· Scanner QR4</h2>

<video id="video" muted playsinline></video>
<br>
<button onclick="startScanner()">DÃ©marrer Scan</button>
<button onclick="stopScanner()">Stop</button>
<button onclick="clearHistory()">Effacer historique</button>

<h3>Historique</h3>
<ul id="history"></ul>

<script>
let codeReader;
let videoElement = document.getElementById('video');

async function startScanner() {
  codeReader = new ZXing.BrowserQRCodeReader();

  try {
    codeReader.decodeFromVideoDevice(
      null,
      videoElement,
      (result, err) => {
        if (result) {
          const value = result.text;
          saveToHistory(value);
          alert("QR dÃ©tectÃ© : " + value);
          stopScanner();
          loadHistory();
        }
      }
    );
  } catch (err) {
    alert("Erreur camÃ©ra : " + err);
  }
}

function stopScanner() {
  if (codeReader) {
    codeReader.reset();
  }
}

function saveToHistory(data) {
  let history = JSON.parse(localStorage.getItem("qrHistory")) || [];
  history.push({
    value: data,
    date: new Date().toLocaleString()
  });
  localStorage.setItem("qrHistory", JSON.stringify(history));
}

function loadHistory() {
  let history = JSON.parse(localStorage.getItem("qrHistory")) || [];
  const historyList = document.getElementById("history");
  historyList.innerHTML = "";

  history.slice().reverse().forEach(item => {
    let li = document.createElement("li");
    li.textContent = item.date + " - " + item.value;
    historyList.appendChild(li);
  });
}

function clearHistory() {
  localStorage.removeItem("qrHistory");
  loadHistory();
}

loadHistory();
</script>

</body>
</html>
